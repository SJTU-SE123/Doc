# 1 概述

## 1.1 编写目的

    为规范本小组PCLOGO开发过程中的代码编写提供参考依据和标准。

## 1.2 预期读者和阅读建议

    软件开发人员。

# 2 排版要求

## 2.1 程序块缩进

    程序块要采用缩进风格编写，缩进的空格数为4个。或者用一个制表符'\t'。

## 2.2 程序块之间空行

    相对独立的程序块之间加一行空行。

## 2.3 长语句和长表达式

    较长的语句（>80字符）要分成多行书写。长表达式要在低优先级运算符处划分新行，运算符置于新行行首。新行适当缩进。

    示例：

    perm_count_msg.head.len = NO7_TO_STAT_PERM_COUNT_LEN 
             \+ STAT_SIZE_PER_FRAM * sizeof( _UL );

    if ((taskno < ax_act_task_number)
             && (n7stat_stat_item_valid (stat_item))) {
         ...// program code
    }

## 2.4 长参数

    若函数或过程中的参数较长，则要进行适当划分。

    示例：

    n7stat_str_compare((BYTE *) & stat_object,
            (BYTE *) & (act_task_table[taskno].stat_object),
            sizeof (_STAT_OBJECT));

## 2.5 短语句

    一行只写至多一条语句。多个短语句写在同一行的情况应当避免。

## 2.6 条件、循环语句

    if、for、do、while、case、switch等语句自占一行。

## 2.7 运算符前后空格

    在两个以上的关键字、变量、常量进行对等操作时，它们之间的操作符之前、之后或者前后要加空格；进行非对等操作时，如果是关系密切的立即操作符（如－>），后不应加空格。
    对于长表达式，可以在局部不加空格。

    示例：

    (1) 逗号、分号只在后面加空格。
        int a, b, c; 

    (2) 比较操作符, 赋值操作符"="、"+="，算术操作符"+"、"%"，逻辑操作符"&&"、"&"，位域操作符"<<"、"^"等双目操作符的前后加空格。
        if (current_time >= MAX_TIME_VALUE) a = b + c;a *= 2;
        a = b ^ 2;

    (3)"!"、"~"、"++"、"--"、"&"（地址运算符）等单目操作符前后不加空格。
        *p = 'a';        // 内容操作"\*"与内容之间
        flag = !isEmpty; // 非操作"!"与内容之间
        p = &mem;        // 地址操作"&"与内容之间
        i++;             // "++","--"与内容之间

    (4)"->"、"."前后不加空格。
        p->id = pid;     // "->"指针前后不加空格

    (5) if、for、while、switch等与后面的括号间应加空格，使if等关键字更为突出、明显。
        if (a >= b && c > d)

# 3 注释

## 3.1 函数头部说明

    函数头部应进行注释，列出：函数的目的/功能、输入参数、输出参数、返回值、调用关系（函数、表）等。

    示例：下面这段函数的注释比较标准，当然，并不局限于此格式。

    /*************************************************

    函数名称：

    函数功能：

    被本函数调用的函数清单：

    输入参数： （每个参数的作用、取值说明及参数间关系）

    返回值：

    其它：

    *************************************************/

## 3.2 注释与代码一致

    边写代码边注释，修改代码同时修改相应的注释，以保证注释与代码的一致性。不再有用的注释要删除。

## 3.3 对注释内容的要求

    注释的内容要清楚、明了，含义准确，防止注释二义性。

## 3.4 注释中的缩写

    首次出现时不要缩写，如果要用到缩写，应当在首次出现时写在括号里进行说明。

## 3.5 注释位置

    上方或右方。

## 3.6 变量、常量的注释

    对于所有有明确含义的变量、常量，如果其命名不是充分自注释的，在声明时都必须加以注释，说明其含义。变量、常量、宏的注释应放在其上方或右方。

## 3.7 数据结构的注释

    数据结构声明(包括数组、结构、类、枚举等)，如果其命名不是充分自注释的，必须加以注释。对数据结构的注释应放在其上方。

## 3.8 全局变量

    全局变量要有较详细的注释，包括对其功能、取值范围、哪些函数或过程存取它以及存取时注意事项等的说明。放在全局变量声明处的上方。

## 3.9 注释排版

    若注释在被注释项的上方，则注释与被注释项左对齐。如果在右方就看着办吧，别太丑就行。

## 3.10 不相关的代码与注释之间插入空行

    将注释与其上面的代码用空行隔开。

    示例：如下例子，显得代码过于紧凑。

    /* code one comments */
    program code one
    /* code two comments */
    program code two

    应如下书写：

    /* code one comments */
    program code one

    /* code two comments */
    program code two

## 3.11 其他

    尽量避免在一行代码或表达式的中间插入注释，否则容易使代码可理解性变差。
    注释建议多使用中文，除非能用非常流利准确的英文表达（可怜可怜孩子吧）。

# 4 标识符命名

## 4.1 命名清晰

    标识符的命名要清晰、明了，有明确含义，同时使用完整的单词或大家基本可以理解的缩写，避免使人产生误解。较短的单词可通过去掉“元音”形成缩写；较长的单词可取单词的头几个字母形成缩写；一些单词有大家公认的缩写。

    示例：
    temp可缩写为tmp
    flag可缩写为flg
    statistic可缩写为stat
    increment可缩写为inc
    message可缩写为msg

## 4.2 变量命名

    避免局部变量与全局变量（如果有的话）重名。
    对于变量命名，禁止取单个字符（如i、j、k...），建议除了要有具体含义外，还能表明其变量类型、数据类型等，但i、j、k作局部循环变量是允许的。
    关于长变量名（通常是由词组转化而来的），采用驼峰命名法，或是使用下划线，将变量名的各个部分区分出来。

## 4.3 特殊命名需注释

    命名中若使用特殊约定或缩写，则要有注释说明。可以写在声明该特殊命名的变量、数据结构或函数时，也可以写在源文件的开头。

## 4.4 其他

    除非必要，不要用数字或较奇怪的字符来定义标识符。
    对于具有互斥意义的变量或相反动作的函数，最好使用正确的反义词组命名。

# 5 可读性

## 5.1 运算符优先级

    注意运算符的优先级，用括号明确表达式的操作顺序，尽量避免使用默认优先级。

## 5.2 尽量避免使用数字作为标识符

    避免使用不易理解的数字，用有意义的标识来替代。涉及物理状态或者含有物理意义的常量，尽量少地直接用数字，而是用有意义的枚举或宏来代替，特别是会用到不止一次的某个数字（比如0，在不同情况下可能有不同含义）。

## 5.3 如果你有独特的编程技巧...

    使用个人独特的编程技巧展现才华时要加上注释，说明用途（不一定要解释算法）。

## 5.4 其他

    源程序中关系较为紧密的部分尽可能相邻。

    示例：以下代码布局不太合理。
    rect.length = 10;
    char_poi = str;
    rect.width = 5;

    若按如下形式书写，可能更清晰一些：
    rect.length = 10;
    rect.width = 5; // 矩形的长与宽关系较密切，放在一起。
    char_poi = str;

# 6 一些别的要求

## 6.1 不使用未经初始化的变量作为右值。

    特别是未经赋值的指针。

## 6.2 可移植性

    使用严格形式定义的、可移植的数据类型，尽量不要使用与具体硬件或软件环境关系密切的变量。

## 6.3 注意数据类型的强制转换

    当进行数据类型强制转换时，其数据的意义、转换后的取值等都有可能发生变化，而这些细节若考虑不周，就很有可能留下隐患。

## 6.4 对编译系统默认的数据类型转换，也要有充分的认识
    
    示例：如下赋值，多数编译器不产生告警，但值的含义还是稍有变化。
    char chr;
    unsigned short int exam;
    chr = -1;
    exam = chr; // 编译器不产生告警，此时exam为0xFFFF

## 6.5 全局变量的保护

    编写可重入函数时，若使用全局变量，则应通过关中断、信号量（即P、V操作）等手段对其加以保护。

## 6.6 断言

    想用就用。
